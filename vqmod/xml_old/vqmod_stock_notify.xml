<modification>
	<id>VQMOD NOTIFY IN STOCK BASIC</id>
	<version>1.0</version>
	<vqmver>2.X</vqmver>
	<author>WEBGURUINDIA</author>


		<file name="catalog/language/english/product/product.php">
            <operation>
                <search position="before"><![CDATA[$_['text_model']]]></search>
                <add><![CDATA[$_['button_notify_button']                   = 'Notify Me';
				$_['oosn_info_text']                   = 'The product is currently Out-of-Stock. Enter your email address below and we will notify you as soon as the product is available.';
				$_['oosn_thanks_text']                 = 'Thank you! You will be notified by email as soon as the product is available.';
				$_['oosn_valid_email']                 = 'Please enter a valid email address.';]]></add>
            </operation>
        </file>
		
		
	<!-- product controller -->
	<file name="catalog/controller/product/product.php">
            <operation>
                <search position="before"><![CDATA[public function upload()]]></search>
                <add><![CDATA[public function notify() {
		$email = $_POST['data'];
		$pid = $_POST['product_id'];
		$this->load->model('catalog/product');
		$this->language->load('product/product');
		$product_info = $this->model_catalog_product->getProduct($pid);
		$product_name = $product_info['name'];
		$sku = $product_info['sku'];	
		//date_default_timezone_set('Asia/Calcutta');  //time zone for India
		$datetime = date("Y-m-d H:i:s");
		$language_code = $this->language->get('code');
		
	if (strlen(trim($_POST['data'])) > 5){
		if ((utf8_strlen($_POST['data']) > 96) || !preg_match('/^[^\@]+@.*\.[a-z]{2,6}$/i', $_POST['data'])) {
			$text = $this->language->get('oosn_valid_email');
		}else {
			$this->db->query("INSERT INTO `" . DB_PREFIX . "out_of_stock_notify` (product_id, email, language_code, enquiry_date) VALUES ('".$pid."','".$email."','".$language_code."','".$datetime."')");
			
			
			/*$mail = new Mail();
			$mail->protocol = $this->config->get('config_mail_protocol');
			$mail->parameter = $this->config->get('config_mail_parameter');
			$mail->hostname = $this->config->get('config_smtp_host');
			$mail->username = $this->config->get('config_smtp_username');
			$mail->password = $this->config->get('config_smtp_password');
			$mail->port = $this->config->get('config_smtp_port');
			$mail->timeout = $this->config->get('config_smtp_timeout');				
			$mail->setTo($this->config->get('config_email'));
			$mail->setFrom($this->config->get('config_email'));
			$mail->setSender($this->config->get('config_name'));//Sender
			$mail->setSubject($this->config->get('oosn_store_mail_sub'), ENT_QUOTES, 'UTF-8');
			
			$mail_body = $this->config->get('oosn_store_mail_body');
			$mail_body = str_replace("{product_name}",$product_name,$mail_body);
			$mail_body = str_replace("{product_id}",$pid,$mail_body);
			$mail_body = str_replace("{sku}",$sku,$mail_body);
			$mail_body = str_replace("{customer_email}",$email,$mail_body);
			
			$mail->setText(strip_tags(html_entity_decode($mail_body, ENT_QUOTES, 'UTF-8')));
			$mail->send();*/
			$text  = $this->language->get('oosn_thanks_text');
			}
	}else	{
		$text = $this->language->get('oosn_valid_email');
	}
		$json['success'] = $text;
		$this->response->setOutput(json_encode($json));	
	}]]></add>
            </operation>
			
			<operation>
                <search position="after"><![CDATA[$this->data['text_model'] = $this->language->get('text_model');]]></search>
                <add><![CDATA[$this->data['notify_button'] = $this->language->get('button_notify_button');
				$this->data['oosn_info_text'] = $this->language->get('oosn_info_text');
				$this->data['quantity'] = $product_info['quantity'];]]></add>
            </operation>
        </file>		
		
		
		
		<!-- If your store has multiple language, use the below commented snippet -->
		<!--
		<file name="catalog/language/LANGUAGE FOLDER/product/product.php">
            <operation>
                <search position="before"><![CDATA[$_['text_model']]]></search>
                <add><![CDATA[$_['button_notify_button']                   = 'Notify Me';
				$_['oosn_info_text']                   = 'The product is currently Out-of-Stock. Enter your email address below and we will notify you as soon as the product is available.';
				$_['oosn_thanks_text']                 = 'Thank you! You will be notified by email as soon as the product is available.';]]></add>
            </operation>
        </file>
		
		-->
		
		<file name="catalog/view/theme/*/template/product/product.tpl">
            <operation>
                <search position="before"><![CDATA[<?php echo $footer; ?>]]>
                </search>
                <add><![CDATA[<script type="text/javascript">
$('#notify_btn').click(function(){
	$('#msg').html('');
	$('#loadingmessage').show();
	$.ajax({
		  type: 'post',
		  url: 'index.php?route=product/product/notify',
		  data: {data: $('#notifyemail').val(),product_id: '<?php echo $product_id; ?>'},
		  dataType: 'json',
		  success: function(json) {
				if (json['success']) {
					  $('#msg').html(json['success']);
					  $('#loadingmessage').hide();
				}
		  }
	 });

 });

</script>]]>
                </add>
            </operation>
			
			
        </file>
	
		<!-- MENU LINKS -->
	 	 <file name="admin/controller/common/header.php">
            <operation>
                <search position="after"><![CDATA[$this->data['feed'] = $this->url->link('extension/feed', 'token=' . $this->session->data['token'], 'SSL');]]></search>
                <add><![CDATA[$this->data['oosnotify_link'] = $this->url->link('extension/oosnotify', 'token=' . $this->session->data['token'], 'SSL');]]></add>
            </operation>
			
			<operation>
                <search position="after"><![CDATA[$this->data['text_feed'] = $this->language->get('text_feed');]]></search>
                <add><![CDATA[$this->data['text_oosnotify'] = $this->language->get('text_oosnotify');]]></add>
            </operation>
        </file>		
		
		<file name="admin/language/*/common/header.php">
            <operation>
                <search position="before"><![CDATA[$_['text_feed']]]></search>
                <add><![CDATA[$_['text_oosnotify']                   = 'Customer Stock Alert';]]></add>
            </operation>
        </file>
		
		<file name="admin/view/template/common/header.tpl">
            <operation>
                <search position="before"><![CDATA[<li><a href="<?php echo $feed; ?>"><?php echo $text_feed; ?></a></li>]]>
                </search>
                <add><![CDATA[<li><a href="<?php echo $oosnotify_link; ?>"><?php echo $text_oosnotify; ?></a></li>]]>
                </add>
            </operation>
        </file>

</modification>