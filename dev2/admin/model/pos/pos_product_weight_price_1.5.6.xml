<modification>    <id>POS Product Weight Based Pricing Support</id>    <version>1.0</version>    <vqmver>2.x</vqmver>    <author>Jimmy: flyingmel.java@gmail.com, Jason: hh4cimm@yahoo.com</author>    <file name="admin/view/template/catalog/product_form.tpl">		<operation>			<search position="before" offset="1"><![CDATA[<td><?php echo $entry_sku; ?></td>]]></search>			<add><![CDATA[            <tr>              <td><?php echo $entry_weight_price; ?></td>              <td><?php if ($weight_price) { ?>                <input type="radio" name="weight_price" value="1" onclick="$('#weight_name_display').show();" checked="checked" />                <?php echo $text_yes; ?>                <input type="radio" name="weight_price" value="0" onclick="$('#weight_name_display').hide();" />                <?php echo $text_no; ?>                <?php } else { ?>                <input type="radio" name="weight_price" value="1" onclick="$('#weight_name_display').show();" />                <?php echo $text_yes; ?>                <input type="radio" name="weight_price" value="0" onclick="$('#weight_name_display').hide();" checked="checked" />                <?php echo $text_no; ?>                <?php } ?>				</td>            </tr>			<tr id="weight_name_display" <?php if (!$weight_price) {?>style="display:none;"<?php } ?>>				<td><?php echo $entry_weight_display_name; ?></td>				<td><input type="text" name="weight_name" value="<?php echo $weight_name; ?>" /></td>			</tr>]]></add>		</operation>    </file>    <file name="admin/language/english/catalog/product.php">		<operation>			<search position="after"><![CDATA[<?php]]></search>			<add><![CDATA[$_['entry_weight_price'] = 'Decimal quantity:<br/><span class="help">Weight, Length ... etc.</span>';			$_['entry_weight_display_name'] = 'Decimal quantity display name:';]]></add>		</operation>    </file>    <file name="admin/controller/catalog/product.php">		<operation>			<search position="before"><![CDATA[$json[] = array(]]></search>			<add><![CDATA[// add additional option for weight			if ($result['weight_price']) {				$option_data[] = array(					'product_option_id' => '-1',					'option_id'         => '-1',					'name'              => 'pos_weight',					'type'              => 'text',					'option_value'      => '1',					'required'          => '0'				);							}]]></add>		</operation>		<operation>			<search position="after"><![CDATA['product_id' => $result['product_id'],]]></search>			<add><![CDATA['weight_price'       => $result['weight_price'],			'weight_name'       => $result['weight_name'],]]></add>		</operation>		<operation>			<search position="after"><![CDATA[$this->data['entry_layout'] = $this->language->get('entry_layout');]]></search>			<add><![CDATA[$this->data['entry_weight_price'] = $this->language->get('entry_weight_price');			$this->data['entry_weight_display_name'] = $this->language->get('entry_weight_display_name');]]></add>		</operation>		<operation>			<search position="after"><![CDATA[$this->data['layouts'] = $this->model_design_layout->getLayouts();]]></search>			<add><![CDATA[    	if (isset($this->request->post['weight_price'])) {      		$this->data['weight_price'] = $this->request->post['weight_price'];			$this->data['weight_name'] = $this->request->post['weight_name'];    	} elseif (!empty($product_info)) {			$this->data['weight_price'] = $product_info['weight_price'];			$this->data['weight_name'] = $product_info['weight_name'];		} else {      		$this->data['weight_price'] = 0;			$this->data['weight_name'] = 'Weight';    	}]]></add>		</operation>    </file>    <file name="admin/model/catalog/product.php">		<operation>			<search position="after"><![CDATA[$product_id = $this->db->getLastId();]]></search>			<add><![CDATA[		if (isset($data['weight_price'])) {			$this->db->query("UPDATE " . DB_PREFIX . "product SET weight_price = '" . (int)$data['weight_price'] . "',  weight_name = '" . $this->db->escape($data['weight_name']) . "' WHERE product_id = '" . (int)$product_id . "'");		}]]></add>		</operation>		<operation>			<search position="after"><![CDATA[public function editProduct($product_id, $data) {]]></search>			<add><![CDATA[		if (isset($data['weight_price'])) {			$this->db->query("UPDATE " . DB_PREFIX . "product SET weight_price = '" . (int)$data['weight_price'] . "',  weight_name = '" . $this->db->escape($data['weight_name']) . "' WHERE product_id = '" . (int)$product_id . "'");		}]]></add>		</operation>    </file>    <file name="system/library/cart.php">		<operation>			<search position="after" offset="1"><![CDATA['recurring_trial_duration'  => $recurring_trial_duration,]]></search>			<add><![CDATA[if (!empty($this->session->data['weight']) && $key == $this->session->data['weight']['key']) {					$this->data[$key]['price'] = $price + $option_price;					$this->data[$key]['total'] = ($price + $option_price) * (float)$this->session->data['weight']['weight'] * $quantity;				}]]></add>		</operation>		<operation>			<search position="replace"><![CDATA[$tax_data[$tax_rate['tax_rate_id']] = ($tax_rate['amount'] * $product['quantity']);]]></search>			<add><![CDATA[if (!empty($this->session->data['weight']) && $product['key'] == $this->session->data['weight']['key']) {					$tax_data[$tax_rate['tax_rate_id']] = ($tax_rate['amount'] * $this->session->data['weight']['weight'] * $product['quantity']);				} else {					$tax_data[$tax_rate['tax_rate_id']] = ($tax_rate['amount'] * $product['quantity']);				}]]></add>		</operation>		<operation>			<search position="replace"><![CDATA[$tax_data[$tax_rate['tax_rate_id']] += ($tax_rate['amount'] * $product['quantity']);]]></search>			<add><![CDATA[if (!empty($this->session->data['weight']) && $product['key'] == $this->session->data['weight']['key']) {					$tax_data[$tax_rate['tax_rate_id']] += ($tax_rate['amount'] * $this->session->data['weight']['weight'] * $product['quantity']);				} else {					$tax_data[$tax_rate['tax_rate_id']] += ($tax_rate['amount'] * $product['quantity']);				}]]></add>		</operation>		<operation>			<search position="replace"><![CDATA[$total += $this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];]]></search>			<add><![CDATA[if (!empty($this->session->data['weight']) && $product['key'] == $this->session->data['weight']['key']) {					$total += $this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')) * $this->session->data['weight']['weight'] * $product['quantity'];				} else {					$total += $this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];				}]]></add>		</operation>    </file></modification>